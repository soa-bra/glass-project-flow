# خطة التكامل التشغيلي للوحدات – سـوبــرا

## أولا- المقدمة
أ. المبدأ الحاكم: هندسة تكامل معيارية مع ضبط الهوية المرجعية (Canonical IDs) ومسارات الأحداث، بحيث تخدم نموذج تشغيل SoaBra، مع منع الكتابة المباشرة لقاعدة بيانات Odoo.  
١. استخدام طبقة تكامل داخلية تعتمد على REST وWebhooks وEvent Bus لتبادل الرسائل بين الوحدات.  
٢. ضمان أن SoaBra.PARTY_ID هو المرجع الموحّد للكيانات، ودعم عملتي Saudi Riyal (SAR) الريال السعودي وUnited States Dollar (USD) دولار أمريكي.

ب. الغرض: إنتاج خريطة تكامل تشغيلية للوحدات المحددة، مع عقود بيانات ورسائل أحداث جاهزة للنشر المرحلي، وربط كل مرحلة بالوحدات والعقود المرتبطة.

جـ. النطاق: يقتصر على الوحدات المذكورة في جرد المكونات، مع استبعاد أي اعتماد على خدمات خارجية غير متوفرة، ومع إمكانية إضافة بوابات دفع أو خدمات اتصال إذا توفرت APIs.

## ثانيا- جرد المكونات والربط
أ. لكل وحدة في الجدول، يجب تحديد النماذج الأساسية، عمليات الإنشاء والقراءة والتحديث والحذف (CRUD)، المدخلات والمخرجات، الاعتماديات داخل Odoo، مستوى التخصيص، المالك، وسقف الخدمة (SLA).  
ب. تعريف مصطلحات موحّدة بين سـوبــرا وOdoo؛ مثل:
١. كيان العميل: SoaBra.PARTY_ID ↔ res.partner.id.  
٢. الموظف: SoaBra.EMP_ID ↔ hr.employee.id.  
٣. الفرصة البيعية: SoaBra.SALES.OPP_ID ↔ crm.lead.id.  
٤. الفاتورة: SoaBra.AR/AP.INV_ID ↔ account.move.id.  
٥. المشروع: SoaBra.PROJECT_ID ↔ project.project.id.  

## ثالثا- عقود البيانات ورسائل الأحداث
أ. تعريف ترويسة مشتركة لكل الرسائل تحتوي على msg_id وschema وsource وtimestamp وactor (مع emp_id وrole).  
ب. تحديد عقود بيانات مختزلة للأحداث الرئيسية مثل LeadCreated وSalesOrderConfirmed وInvoicePosted وTimesheetLogged، بحيث يحتوي body على حقول المعرفات والبيانات المطلوبة فقط.  
جـ. استخدام بروتوكول JSON / REST (جاڤا سكريبت أوبجكت نوتيشين / نقل الحالة التمثيلي) مع توقيع HMAC لضمان سلامة الرسائل.

## رابعا- مصفوفة التكامل والاعتماديات
أ. إنشاء مصفوفة توضح نوع العلاقة بين كل وحدة والأخرى (اعتماد مباشر، تبادل بيانات، مشغلات/أحداث، محول).  
ب. تحديد نقاط الربط الحرجة التي تتطلب تحويلات أو محولات بين الوحدات.  
جـ. تحديد مخاطر التكامل وضوابط الحوكمة (مثل توافق ZATCA للفوترة الإلكترونية، حماية خصوصية الموظفين).

## خامسا- تقييم الوضع الحالي
أ. الوحدات المتوفرة والمتكاملة حاليًا: المصروفات والموافقات؛ الإجازات والتقييمات مع HR Lite؛ خدمة الفوترة؛ CRM؛ KB؛ Surveys؛ Event Bus.  
ب. الوحدات المتوفرة بدون تكامل كامل: الفوترة غير مرتبطة بالمبيعات أو العقود؛ CRM لا يسحب العملاء من التسويق ولا يحول الفرص إلى أوامر؛ KB غير مرتبطة بالمهام؛ Surveys غير مرتبطة بالفعاليات.  
جـ. الوحدات المفقودة: المحاسبة، Discuss، VoIP، Recruitment، Referrals، Sales، Social Marketing، Events، Marketing Automation، Project، Timesheet، Planning، Appointments، الموارد البشرية الكاملة، وغيرها.

## سادسا- خطة التطوير المرحلية
### أ. المرحلة الأولى – البنية الأساسية
١. تصميم مخطط قاعدة بيانات في Supabase يغطي الكيانات الرئيسية (العملاء، الموظفين، الحسابات، الفرص، أوامر البيع، المشاريع، الجداول الزمنية، الحملات).  
٢. تطوير وحدة المبيعات Sales لتحويل الفرص إلى عروض وأسعار ثم أوامر بيع وفواتير.  
٣. توسيع وحدة الفوترة والمحاسبة لدمج العقود والأوامر وإضافة وظائف دفتر الأستاذ والضرائب المحلية والتقارير المالية.  
٤. دمج Event Bus مع جميع الوحدات لإرسال واستقبال الأحداث دون مشاركة قاعدة البيانات مباشرة.

### ب. المرحلة الثانية – الموارد البشرية والتشغيل
١. بناء وحدة Recruitment لإدارة الوظائف والمرشحين وتحويل المقبولين إلى موظفين.  
٢. إضافة برنامج Referrals لإحالات الموظفين وربط النقاط والمكافآت.  
٣. توسيع HR لإدارة الرواتب والعقود والتدريب، وربطها بوحدة Timesheet.  
٤. تطوير Timesheet متكامل لاحتساب ساعات العمل وربطها بالمشاريع والفوترة.

### جـ. المرحلة الثالثة – التسويق والفعاليات
١. إنشاء Social Marketing (التسويق عبر الشبكات الاجتماعية) لجمع التفاعلات وتحويلها لعملاء محتملين وربطها بـ CRM.  
٢. تطوير Marketing Automation (أتمتة التسويق) لإدارة حملات مؤتمتة ورعاية العملاء.  
٣. إنشاء Events لإدارة الفعاليات والتذاكر والتسجيلات مع ربط الاستطلاعات وبيانات الحضور.  
٤. تحسين Surveys لربط الاستطلاعات بالفعاليات والتقييمات والموارد البشرية.

### د. المرحلة الرابعة – المشاريع والتخطيط والتواصل
١. إنشاء Project لإدارة المشاريع والمهام والمراحل وربطها بأوامر البيع والفوترة.  
٢. تطوير Planning لتخطيط الموارد ومقارنة الساعات المجدولة بالفعلية باستخدام Timesheets.  
٣. إنشاء Appointments للسماح بحجز المواعيد وربطها بالفرص البيعية داخل CRM.  
٤. إنشاء Discuss/VoIP لتوفير قنوات محادثة وصوت مرتبطة بالكيانات (العملاء، الفرص، المهام).

### هـ. المرحلة الخامسة – التحسين والتوسع
١. إنشاء Feature Store لجمع وتحليل مؤشرات الأداء والولاء والقيم الثقافية.  
٢. تكامل اختياري مع بوابات الدفع أو مزودي الاتصال الصوتي عبر APIs، مع الالتزام بالأمان والامتثال المحلي.  
٣. مراجعة العقود والرسائل بصفة دورية وتحديثها حسب نضج النظام واحتياجات العمل.

## سابعا- معايير القياس والحوكمة
أ. تحديد مؤشرات الأداء الرئيسية لكل وحدة (مثل زمن إصدار الفاتورة، معدل تحويل الفرص، دقة سجلات الموارد البشرية، نسبة التحصيل).  
ب. إعداد اختبارات قبول للتأكد من صحة التكامل وموثوقية التدفقات بين الوحدات.  
جـ. تطبيق سياسات أمنية وخصوصية صارمة في قاعدة البيانات (Supabase) بما يتوافق مع التشريعات السعودية، وتوثيق العمليات في Audit Log.

## ثامنا- توصيات ختامية
أ. تحديث وثائق المشروع وملف README لتوضيح بنية التكامل والبيانات والعقود.  
ب. مشاركة هذه الخطة مع الفريق التقني والإداري للحصول على التغذية الراجعة وتحديد أولويات التنفيذ.  
جـ. إجراء مراجعات دورية كل أسبوعين لمتابعة التقدم وتعديل الأولويات حسب الموارد والاحتياجات.
